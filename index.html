<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coloso NOVA 대시보드</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f7f9fb; }
        /* AI Score Colors */
        .score-9 { background-color: #10b981; color: white; } /* Emerald */
        .score-8 { background-color: #f59e0b; color: white; } /* Amber */
        .score-7 { background-color: #f97316; color: white; } /* Orange */
        /* CRM Styling */
        .kanban-column { min-height: 500px; background-color: #ffffff; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1); }
        .kanban-card { transition: transform 0.2s, box-shadow 0.2s; }
        .kanban-card:hover { transform: translateY(-3px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1); }
        .tab-active { background-color: #4f46e5; color: white; }
        .sub-tab-active { border-bottom: 3px solid #4f46e5; color: #4f46e5; font-weight: 600; }
        /* Report Clickable Style */
        .report-clickable { cursor: pointer; text-decoration: underline; text-decoration-color: #a5b4fc; text-underline-offset: 4px; transition: color 0.1s; }
        .report-clickable:hover { color: #4f46e5; }

        /* Modal backdrop for blocking outside clicks */
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(15, 23, 42, 0.8); /* slate-900 with opacity */
            z-index: 49; /* Below modal content but above everything else */
        }
    </style>
    <script>
        // 글로벌 상태 관리 및 상수
        let activeTab = 'dashboard';
        let activeSubTab = 'ai-result'; // 'ai-result' 또는 'saved-list'
        let instructors = [];
        const ITEMS_PER_PAGE = 10; // 페이지당 10개 리스트
        let currentPage = 1;
        const plannerName = "김태형 플래너"; // 기획자 이름 더미 데이터

        // 아이콘 (로고) SVG 정의
        const logoSVG = {
            'Instagram': `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-pink-500"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line></svg>`,
            'Twitter/X': `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="white" class="text-gray-900 bg-black rounded-full"><path d="M13.447 11.907L20.443 4H18.083L12.396 10.994L7.848 4H4L11.536 15.112L4 20H6.36L12.373 13.084L17.152 20H21L13.447 11.907ZM7.276 5.118H6.182L17.747 18.892H18.842L7.276 5.118Z"/></svg>`,
            'Behance': `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="#0057ff" class="text-white"><circle cx="12" cy="12" r="12" fill="#0057ff"/><path fill="#FFFFFF" d="M9.135 15.35c.18.27.3.56.36.87.06.31.09.58.09.8a1.27 1.27 0 00-.31.87c-.18.33-.5.5-.96.5a2.22 2.22 0 01-1.25-.33v2.85h-1.9v-8.4h2.17c1.47 0 2.47.38 3.03 1.15.56.77.85 1.9.85 3.39 0 .4-.03.8-.09 1.16-.06.36-.18.72-.34 1.05zM7.22 9.4h2.23c.74 0 1.25-.13 1.55-.4.3-.27.45-.66.45-1.17s-.15-.9-.45-1.17c-.3-.27-.8-.4-1.55-.4H7.22v3.14zM16.14 15.2c.18.25.29.53.33.84.05.31.08.6.08.85 0 .6-.18 1.04-.54 1.3-.36.26-.95.39-1.78.39-1.2 0-2.12-.4-2.75-1.19a3.86 3.86 0 01-1-2.91 4.7 4.7 0 01.99-3.05c.63-.75 1.58-1.14 2.85-1.14 1.24 0 2.15.3 2.75.9.6.6.9 1.5.9 2.7 0 .3-.03.6-.09.84-.06.24-.16.5-.32.75zM14.28 9.4h2.23c.74 0 1.25-.13 1.55-.4.3-.27.45-.66.45-1.17s-.15-.9-.45-1.17c-.3-.27-.8-.4-1.55-.4h-2.23v3.14z"/></svg>`,
            'Gmail': `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-red-500"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>`
        };
        const gmailIcon = logoSVG['Gmail'];
        const bookmarkEmpty = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 text-gray-400 hover:text-indigo-500 transition duration-150"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path></svg>`;
        const bookmarkFilled = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="#4f46e5" stroke="#4f46e5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 text-indigo-600 transition duration-150"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path></svg>`;


        const funnelStages = {
            'Qualified': '적격 후보 (AI 발굴)',
            'Initial Contact Sent': '초기 컨택 완료',
            'In Communication': '협의 진행 중',
            'Contract': '계약 단계'
        };

        // 시연용 초기 더미 데이터 (Nekojira 추가)
        const initialInstructors = [
             // Nekojira 추가 (최상단)
            { id: 100, name: "Nekojira", platform: "Twitter/X", stage: "Qualified", url: "https://x.com/Nekojira", followers: "634K", engagement: "25%", aiScore: 9.8, style: "서브컬처 풍 일러스트", trend: "글로벌 시장 (미국/일본/태국)", comment: "압도적인 팬덤과 퀄리티, 즉시 콜로소 강의 기획 착수 필요.", selected: false, saved: true, lastContact: { date: "N/A", medium: "N/A", planner: "N/A", isReplied: false }, lastResponse: null, contactTarget: "Nekojira" },
            { id: 101, name: "ArtValkyrie", platform: "Instagram", stage: "Qualified", url: "https://instagram.com/artvalkyrie", followers: "125K", engagement: "15%", aiScore: 9.3, style: "사이버펑크 디자인", trend: "태국 시장", comment: "퀄리티 최상, 콜로소 중복 낮음.", selected: false, saved: false, lastContact: { date: "N/A", medium: "N/A", planner: "N/A", isReplied: false }, lastResponse: null, contactTarget: "artvalkyrie@gmail.com" },
            { id: 102, name: "PixelSmith", platform: "Twitter/X", stage: "Qualified", url: "https://x.com/pixelsmith", followers: "45K", engagement: "22%", aiScore: 8.7, style: "레트로 픽셀 아트", trend: "글로벌 수요", comment: "팬덤 강력, 커리큘럼 논의 필요.", selected: false, saved: true, lastContact: { date: "N/A", medium: "N/A", planner: "N/A", isReplied: false }, lastResponse: null, contactTarget: "pixelsmith" },
            { id: 103, name: "DigitalMonk", platform: "Behance", stage: "Qualified", url: "https://behance.net/digitalmonk", followers: "80K", engagement: "7%", aiScore: 9.0, style: "동양화 일러스트", trend: "일본 시장", comment: "독보적 스타일, 잠재 고객 층 확실.", selected: false, saved: false, lastContact: { date: "N/A", medium: "N/A", planner: "N/A", isReplied: false }, lastResponse: null, contactTarget: "digitalmonk@gmail.com" },
            { id: 104, name: "ConceptDreamer", platform: "Twitter/X", stage: "Qualified", url: "https://x.com/conceptdreamer", followers: "110K", engagement: "14%", aiScore: 8.8, style: "컨셉 아트", trend: "대규모 프로젝트", comment: "긍정적 회신, 미팅 시간 조율 중.", selected: false, saved: false, lastContact: { date: "N/A", medium: "N/A", planner: "N/A", isReplied: false }, lastResponse: null, contactTarget: "conceptdreamer" },
            { id: 105, name: "VibeSketch", platform: "Behance", stage: "Qualified", url: "https://behance.net/vibesketch", followers: "30K", engagement: "10%", aiScore: 7.9, style: "패션 스케치", trend: "정체 중", comment: "니치 마켓, 성장률 체크 필요.", selected: false, saved: false, lastContact: { date: "N/A", medium: "N/A", planner: "N/A", isReplied: false }, lastResponse: null, contactTarget: "vibesketch@gmail.com" },
            { id: 106, name: "VoxelGenius", platform: "Instagram", stage: "Qualified", url: "https://instagram.com/voxelgenius", followers: "55K", engagement: "19%", aiScore: 8.5, style: "복셀 3D 모델링", trend: "메타버스 인기", comment: "새로운 분야의 선구자, 시장 테스트 적합.", selected: false, saved: false, lastContact: { date: "N/A", medium: "N/A", planner: "N/A", isReplied: false }, lastResponse: null, contactTarget: "voxelgenius@gmail.com" },
            { id: 107, name: "LineAnimator", platform: "Twitter/X", stage: "Qualified", url: "https://x.com/lineanimator", followers: "95K", engagement: "16%", aiScore: 9.1, style: "2D 라인 애니메이션", trend: "바이럴 가능성 높음", comment: "단순하지만 매력적인 콘텐츠.", selected: false, saved: true, lastContact: { date: "N/A", medium: "N/A", planner: "N/A", isReplied: false }, lastResponse: null, contactTarget: "lineanimator" },
            { id: 108, name: "Photorealist", platform: "Behance", stage: "Qualified", url: "https://behance.net/photorealist", followers: "130K", engagement: "5%", aiScore: 8.2, style: "극사실주의 페인팅", trend: "고급 스킬 시장", comment: "압도적인 기술력, 강의 난이도 조절 필요.", selected: false, saved: false, lastContact: { date: "N/A", medium: "N/A", planner: "N/A", isReplied: false }, lastResponse: null, contactTarget: "photorealist@gmail.com" },
            { id: 109, name: "CreativeCoder", platform: "Instagram", stage: "Qualified", url: "https://instagram.com/creativecoder", followers: "40K", engagement: "17%", aiScore: 7.8, style: "프로그래밍 아트", trend: "신기술 결합", comment: "새로운 시도, 기술적 검증 필요.", selected: false, saved: false, lastContact: { date: "N/A", medium: "N/A", planner: "N/A", isReplied: false }, lastResponse: null, contactTarget: "creativecoder@gmail.com" },
            { id: 110, name: "CharcoalMaster", platform: "Twitter/X", stage: "Qualified", url: "https://x.com/charcoalmaster", followers: "65K", engagement: "11%", aiScore: 8.4, style: "전통 숯 드로잉", trend: "클래식 아트", comment: "안정적인 수요층 확보.", selected: false, saved: false, lastContact: { date: "N/A", medium: "N/A", planner: "N/A", isReplied: false }, lastResponse: null, contactTarget: "charcoalmaster" },
            
            { id: 201, name: "NeonSculptor", platform: "Instagram", stage: "Initial Contact Sent", url: "https://instagram.com/neonsculptor", followers: "180K", engagement: "12%", aiScore: 9.5, style: "네온 3D 모델링", trend: "미국 트렌드", comment: "최고 점수, 즉시 컨택 필요.", selected: false, saved: true, lastContact: { date: "2025-10-01", medium: "Gmail", planner: plannerName, isReplied: false, content: "안녕하세요, NeonSculptor님. 저희 Coloso는 연사님의 네온 3D 모델링 작품에 큰 감명을 받았습니다. 강의 제안서 첨부합니다." }, lastResponse: null, contactTarget: "neonsculptor@gmail.com" },
            { id: 202, name: "InkFlow", platform: "Twitter/X", stage: "Initial Contact Sent", url: "https://x.com/inkflow", followers: "60K", engagement: "18%", aiScore: 8.5, style: "카툰 드로잉", trend: "높은 호환성", comment: "대중적 스타일, 접근성 좋음.", selected: false, saved: false, lastContact: { date: "2025-10-05", medium: "Instagram DM", planner: plannerName, isReplied: false, content: "안녕하세요! 저희는 InkFlow님의 카툰 드로잉 강의를 제안드립니다. 확인 부탁드려요." }, lastResponse: null, contactTarget: "inkflow" },
            
            { 
                id: 301, name: "MotionWizard", platform: "Instagram", stage: "In Communication", url: "https://instagram.com/motionwizard", followers: "200K", engagement: "10%", aiScore: 9.1, style: "모션 그래픽", trend: "높은 검색량", comment: "콜로소 강의 제안 수락.", selected: false, saved: true,
                lastContact: { date: "2025-09-20", medium: "Gmail", planner: plannerName, isReplied: true, content: "제안서 발송 (초기 제안)" },
                lastResponse: { medium: "Instagram DM", date: "2025-09-23", summary: "주제 조정 요청: '기초 모션' 대신 '고급 이펙트'로 진행 희망.", fullContent: "DM 내용: 제안 감사드립니다! 기초 과정은 이미 많은 채널에서 다루고 있어, 저는 고급 테크닉(파티클/시뮬레이션) 위주로 진행하고 싶습니다. 내부 검토 부탁드려요.", followUpDays: 20, todo: "강의 주제 '고급 이펙트'로 조정 및 커리큘럼 초안 재전달." }, contactTarget: "motionwizard"
            },
            { 
                id: 302, name: "WebFlowMaster", platform: "Behance", stage: "In Communication", url: "https://behance.net/webflowmaster", followers: "50K", engagement: "8%", aiScore: 8.0, style: "웹 디자인/UX", trend: "실무 수요", comment: "모든 조건 합의 완료.", selected: false, saved: false,
                lastContact: { date: "2025-09-25", medium: "Gmail", planner: plannerName, isReplied: true, content: "강의료 재조정 요청" },
                lastResponse: { medium: "Gmail", date: "2025-10-01", summary: "강의료 협상 요청 (기존 제안 대비 15% 인상 희망).", fullContent: "메일 내용: 제안서 잘 받았습니다. 강의 주제는 마음에 듭니다. 다만, 이 정도 규모의 강의라면 강의료를 15% 인상하는 것을 고려해주시면 좋겠습니다. 회신 기다리겠습니다.", followUpDays: 12, todo: "강의료 조정 재무팀과 협의 및 재제안." }, contactTarget: "webflowmaster@gmail.com"
            },
            
            { id: 401, name: "GameArtist", platform: "Instagram", stage: "Contract", url: "https://instagram.com/gameartist", followers: "150K", engagement: "13%", aiScore: 9.6, style: "게임 원화", trend: "최대 인기", comment: "최종 계약서 서명 대기.", selected: false, saved: true, lastContact: { date: "2025-10-08", medium: "Gmail", planner: plannerName, isReplied: false, content: "계약 조건 최종 합의" }, lastResponse: null, contractDraft: "GameArtist 강의 제작 계약서\n\n1. 강의명: [최신 트렌드 게임 원화]\n2. 연사: GameArtist\n3. 강의료: 50,000,000원 (최종 협의)\n4. 계약일: 2025년 10월 13일\n\n[이하 상세 조항 생략]", contactTarget: "gameartist@gmail.com" },
        ];
        
        // 초기화
        instructors = [...initialInstructors];

        // 탭 변경
        function setTab(tabName) {
            activeTab = tabName;
            currentPage = 1; // 탭 변경 시 페이지 초기화
            activeSubTab = 'ai-result'; // 메인 탭 변경 시 서브 탭 초기화
            renderApp();
        }

        function setSubTab(subTabName) {
            activeSubTab = subTabName;
            currentPage = 1;
            renderCreatorDashboard();
        }

        // --- 공통 유틸리티 함수 ---

        // 모달 표시 (alert 대체)
        function showModal(title, message, isSuccess = false, hasConfirm = false, confirmAction = null, confirmId = null) {
            document.getElementById('modal-title').innerText = title;
            document.getElementById('modal-body').innerHTML = message;
            
            const icon = document.getElementById('modal-icon');
            icon.innerHTML = isSuccess 
                ? `<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-green-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>` 
                : `<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-indigo-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" /></svg>`;
            
            // 버튼 영역 초기화
            const buttonContainer = document.getElementById('modal-buttons');
            buttonContainer.innerHTML = '';
            
            if (hasConfirm) {
                // '예', '아니오' 버튼
                buttonContainer.innerHTML = `
                    <button onclick="closeModal(); ${confirmAction}(${confirmId})" class="bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700 transition">예</button>
                    <button onclick="closeModal()" class="bg-gray-200 text-gray-800 px-6 py-2 rounded-lg hover:bg-gray-300 transition">아니오</button>
                `;
            } else {
                // '확인' 버튼만 (모든 모달에 기본적으로 닫기 버튼 제공)
                buttonContainer.innerHTML = `
                    <button onclick="closeModal()" class="bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700 transition">확인</button>
                `;
            }

            document.getElementById('custom-modal').classList.remove('hidden');
        }

        // 모달 닫기
        function closeModal() {
            // 모달 크기 복원 로직
            const modalContainer = document.getElementById('custom-modal').querySelector('div:first-child');
            if (modalContainer) {
                // max-w-3xl이 적용되었었다면 제거하고 max-w-lg를 다시 추가
                modalContainer.classList.remove('max-w-3xl');
                modalContainer.classList.add('max-w-lg');
            }
            document.getElementById('custom-modal').classList.add('hidden');
            if (activeTab === 'crm') {
                 renderContactManagement();
            }
        }

        // PDF 다운로드 시뮬레이션 (생략)
        function downloadPdf(filename) { /* ... */ }
        
        // 전송 확인 모달 (1단계: 전송하시겠습니까?)
        function confirmSendTemplate(id) {
            const contentInput = document.getElementById('contact-content');
            if (!contentInput || !contentInput.value.trim()) {
                showModal('알림', '메일 내용을 입력해주세요.');
                return;
            }

            const message = `<p class="text-md font-semibold">선택된 연사에게 컨택 메시지를 전송하시겠습니까?</p><p class="text-sm text-gray-500 mt-2">전송 후 'Creator Contact Management'에서 현황 관리가 가능합니다.</p>`;
            showModal('전송 확인', message, false, true, 'sendTemplateConfirmed', id);
        }

        // 전송 완료 모달 (2단계: 전송 완료되었습니다)
        function sendTemplateConfirmed(id) {
            const selectedInstructor = instructors.find(inst => inst.id === id);
            
            instructors = instructors.map(inst => 
                inst.id === id ? { ...inst, stage: 'Initial Contact Sent', selected: false, 
                    lastContact: { 
                        date: new Date().toISOString().slice(0, 10), 
                        medium: document.getElementById('contact-channel').value, 
                        planner: plannerName, 
                        isReplied: false, 
                        content: document.getElementById('contact-content').value 
                    } 
                } : { ...inst, selected: false }
            );

            showModal('전송 완료!', `
                <p class="text-xl font-bold text-green-600 mb-2">✅ 성공적으로 전송되었습니다!</p>
                <p class="text-md text-gray-700">${selectedInstructor.name}님에게 컨택 메시지가 발송되었습니다.</p>
                <p class="text-sm text-gray-500 mt-2">현황은 'Creator Contact Management'에서 '초기 컨택 완료' 스테이지로 이동하여 관리하실 수 있습니다.</p>
            `, true);
            
            renderCreatorDashboard();
        }

        // --- Bookmark (Saved List) 기능 ---

        // 북마크 상태 토글 (Saved List에 추가/삭제)
        function toggleBookmark(id) {
            const instructor = instructors.find(inst => inst.id === id);
            if (!instructor) return;

            if (instructor.saved) {
                // 해제 로직 (팝업 확인)
                const message = `<p class="text-md font-semibold">${instructor.name}님을 '저장된 크리에이터 목록'에서 삭제하시겠습니까?</p><p class="text-sm text-red-500 mt-2">삭제 시 찜 목록에서만 제거되며, AI 스크리닝 결과에는 남아있습니다.</p>`;
                showModal('저장 취소 확인', message, false, true, 'confirmRemoveBookmark', id);
            } else {
                // 추가 로직
                instructors = instructors.map(inst => 
                    inst.id === id ? { ...inst, saved: true } : inst
                );
                showModal('찜 목록 추가 완료', `<strong>${instructor.name}</strong>님이 찜 목록에 추가되었습니다.`, true);
                renderApp();
            }
        }
        
        // 찜 목록 삭제 최종 확인
        function confirmRemoveBookmark(id) {
             instructors = instructors.map(inst => 
                inst.id === id ? { ...inst, saved: false } : inst
            );
            
            // Saved Creator List 탭에 있을 경우, 목록을 새로고침
            if (activeSubTab === 'saved-list') {
                renderCreatorDashboard(); 
            }
        }

        // --- Tab 1: Creator Dashboard (연사 발굴) 기능 ---

        // 연사 선택/해제
        function toggleSelection(id) {
            instructors = instructors.map(inst => 
                inst.id === id ? { ...inst, selected: !inst.selected } : { ...inst, selected: false } // 단일 선택 강제
            );
            renderCreatorDashboard();
        }

        // 연사 삭제
        function deleteInstructor(id, name) {
            if (confirm(`정말로 ${name} 연사 후보를 목록에서 삭제하시겠습니까?`)) {
                instructors = instructors.filter(inst => inst.id !== id);
                renderCreatorDashboard();
            }
        }

        // 새 연사 추가 시뮬레이션
        function addManualInstructor() {
            const platform = document.getElementById('manual-platform').value;
            const creatorId = document.getElementById('manual-id').value.trim();

            if (!creatorId) {
                showModal('입력 오류', 'Creator ID 또는 URL을 입력해주세요.');
                return;
            }

            // 중복 검사
            if (instructors.some(inst => inst.name === creatorId)) {
                showModal('중복 오류', `${creatorId}님은 이미 목록에 존재합니다.`);
                document.getElementById('manual-id').value = '';
                return;
            }

            const newId = Date.now();
            const newInstructor = {
                id: newId,
                name: creatorId,
                platform: platform,
                stage: "Qualified",
                url: platform === 'Instagram' ? `https://instagram.com/${creatorId}` : platform === 'Twitter/X' ? `https://x.com/${creatorId}` : `https://behance.net/${creatorId}`,
                followers: "N/A", engagement: "N/A", aiScore: 'Loading',
                style: "AI 분석 중...", trend: "AI 분석 중...", 
                comment: `<div class="w-full h-2 bg-gray-200 rounded-full overflow-hidden"><div class="h-2 bg-indigo-500 animate-[pulse_1s_infinite]"></div></div> AI가 소셜 데이터 수집 및 멀티모달 분석을 진행하고 있습니다. (3초 소요)`,
                selected: false, saved: false, lastContact: { date: "N/A", medium: "N/A", planner: "N/A", isReplied: false }, lastResponse: null, contactTarget: platform === 'Instagram' || platform === 'Twitter/X' ? creatorId : `${creatorId.toLowerCase().replace(/\s/g, '')}@gmail.com`
            };

            instructors.unshift(newInstructor);
            setPage(1); // 새 항목 추가 시 1페이지로 이동
            renderCreatorDashboard();

            // 3초 후 AI 분석 완료 시뮬레이션
            setTimeout(() => {
                instructors = instructors.map(inst => {
                    if (inst.id === newId) {
                        return { 
                            ...inst, 
                            aiScore: 8.9, 
                            followers: "75K", 
                            engagement: "11%",
                            style: "미니멀리즘 웹툰", 
                            trend: "한국 시장 신흥 트렌드", 
                            comment: "수동 추가된 연사. AI 스코어링 완료. 즉시 컨택 추천. (데이터는 AI 툴 시뮬레이션 결과입니다.)" 
                        };
                    }
                    return inst;
                });
                renderCreatorDashboard();
            }, 3000);

            document.getElementById('manual-id').value = '';
        }
        
        // 템플릿 생성 및 에디터 로드
        function generateTemplateContent(isReply = false, replyInstId = null) {
            const selectedInstructor = isReply 
                ? instructors.find(inst => inst.id === replyInstId)
                : instructors.find(inst => inst.selected);

            if (!selectedInstructor) return;

            // LLM 시뮬레이션: 데이터 기반으로 템플릿 채우기
            const subjectPrefix = isReply ? "Re: " : "";
            const subjectContent = isReply ? `강의료 조정 재제안 - ${selectedInstructor.name}님` : `${selectedInstructor.style.split(' ')[0]} 강의 제안`;
            const subject = subjectPrefix + subjectContent;
            
            let content = '';
            
            if (isReply) {
                // 회신 내용 생성 시뮬레이션
                content = `안녕하세요, ${selectedInstructor.name}님.

저희 내부 검토 결과, 요청하신 강의료 인상(15%)에 대해 일부 조정된 조건으로 재제안 드립니다.
(AI 기반 최적 협상 조건 도출)
기존 제안 대비 10% 인상된 [XX,XXX,XXX원]을 최종 제안하며, 대신 강의 런칭 후 6개월간의 프로모션 진행에 협조를 부탁드립니다.

[AI 요약: 이전 응답: ${selectedInstructor.lastResponse.summary}]
빠른 회신 기다리겠습니다.

감사합니다.
- ${plannerName} 드림`;
            } else {
                // 초기 컨택 내용 생성 시뮬레이션
                content = `안녕하세요, ${selectedInstructor.name}님.

저는 글로벌 온라인 교육 플랫폼 Coloso의 콘텐츠 기획 담당자 ${plannerName}입니다.

최근 저희 NOVA AI 시스템이 연사님의 [${selectedInstructor.style}] 작업물에 주목했습니다. (AI 스코어: ${selectedInstructor.aiScore}점) 
연사님의 작품이 [${selectedInstructor.trend}] 트렌드에 부합하며, Coloso와 함께하면 폭발적인 반응을 얻을 수 있을 것이라 확신합니다.

저희는 연사님의 전문 분야인 [${selectedInstructor.style}]에 대한 온라인 강의 기획을 제안드립니다. 자세한 내용은 회신 주시면 논의 드리고 싶습니다.

감사합니다.
- ${plannerName} 드림`;
            }

            const containerId = isReply ? 'reply-content' : 'template-content';
            const container = document.getElementById(containerId);
            container.innerHTML = `
                <div class="space-y-4 p-4 bg-white rounded-lg border">
                    <label class="block">
                        <span class="text-sm font-medium text-gray-700">수신 채널 (API 연동)</span>
                        <select id="contact-channel" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border">
                            <option value="Gmail">Gmail (메일 API)</option>
                            <option value="Instagram DM">Instagram DM (SNS API)</option>
                            <option value="X Message">X Message (SNS API)</option>
                        </select>
                    </label>
                    <label class="block">
                        <span class="text-sm font-medium text-gray-700">수신자 ID/주소</span>
                        <input type="text" id="contact-target-input" value="${selectedInstructor.contactTarget}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border bg-gray-50">
                    </label>
                    <label class="block">
                        <span class="text-sm font-medium text-gray-700">제목 (LLM 자동 생성 & 수정 가능)</span>
                        <input type="text" id="contact-subject" value="${subject}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border">
                    </label>
                    <label class="block">
                        <span class="text-sm font-medium text-gray-700">내용 (LLM 자동 생성 & 수정 가능)</span>
                        <textarea id="contact-content" rows="8" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border">${content}</textarea>
                    </label>
                </div>
            `;
            // 회신 버튼은 여기서 생성되어 모달 내부에 배치됨
            if(isReply) {
                 document.getElementById('reply-content').innerHTML += `<button onclick="confirmSendReply(${selectedInstructor.id})" class="mt-3 w-full bg-green-600 text-white font-bold py-2 rounded-lg hover:bg-green-700 transition">회신 전송</button>`;
            }
        }

        // 회신 전송 확인 모달
        function confirmSendReply(id) {
            if (!document.getElementById('contact-content') || !document.getElementById('contact-content').value.trim()) {
                showModal('알림', '회신 내용을 입력해주세요.');
                return;
            }

            document.getElementById('modal-body').innerHTML = `<p class="text-md font-semibold">AI 기반으로 생성된 회신 내용을 전송하시겠습니까?</p>`;
            document.getElementById('modal-title').innerText = '회신 전송 확인';

            const modalBody = document.getElementById('modal-body');
            modalBody.innerHTML += `<div class="mt-4 flex justify-end space-x-2"><button onclick="closeModal(); sendReplyConfirmed(${id});" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition">네</button><button onclick="closeModal()" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300 transition">아니오</button></div>`;
            document.getElementById('custom-modal').classList.remove('hidden');
        }

        // 회신 전송 실행 후 완료 모달
        function sendReplyConfirmed(id) {
            const selectedInstructor = instructors.find(inst => inst.id === id);
            
            // 상태 업데이트: In Communication 상태 유지 (시연용)
            showModal('회신 전송 완료!', `
                <p class="text-xl font-bold text-green-600 mb-2">✅ 회신이 성공적으로 전송되었습니다!</p>
                <p class="text-md text-gray-700">${selectedInstructor.name}님에게 협의 내용이 전달되었습니다.</p>
                <p class="text-sm text-gray-500 mt-2">다음 회신을 기다리며 To-Do를 업데이트해주세요.</p>
            `, true);
        }

        // 계약서 발송 시뮬레이션
        function sendContractEmail(name) {
            const contractContent = document.getElementById('contract-editor').value;
            const emailAddress = prompt(`최종 계약서를 수신할 이메일 주소를 입력해주세요 (예: ${name.toLowerCase().replace(/\s/g, '')}@gmail.com):`);
            
            if (emailAddress) {
                showModal('최종 계약서 발송 시뮬레이션', `
                    <p class="text-md font-semibold">Gmail API 연동 발송</p>
                    <div class="p-4 bg-gray-50 rounded-lg text-sm space-y-1 mt-3">
                        <p><strong>수신:</strong> ${emailAddress}</p>
                        <p><strong>제목:</strong> [Coloso] ${name}님 - 최종 강의 제작 계약서 건</p>
                        <p><strong>첨부파일:</strong> ${name}_계약서_최종본.pdf (계약서 초안 내용 기반)</p>
                    </div>
                    <p class="text-green-600 font-bold mt-3">✅ Gmail API를 통해 계약서 첨부 및 발송이 완료되었습니다.</p>
                `, true);
            }
        }

        // --- 페이징 함수 ---
        function setPage(page) {
            currentPage = page;
            renderApp();
        }

        function renderPagination(totalItems) {
            const totalPages = Math.ceil(totalItems / ITEMS_PER_PAGE);
            if (totalPages <= 1) return '';

            let pages = [];
            for (let i = 1; i <= totalPages; i++) {
                pages.push(`
                    <button onclick="setPage(${i})" class="px-4 py-2 text-sm font-medium rounded-lg ${currentPage === i ? 'bg-indigo-600 text-white' : 'bg-white text-gray-700 border hover:bg-gray-100'}">
                        ${i}
                    </button>
                `);
            }
            return `<div class="flex justify-center mt-6 space-x-2">${pages.join('')}</div>`;
        }
        
        // --- AI Full Report 기능 ---

        function showFullReport(id) {
            const inst = instructors.find(i => i.id === id);
            if (!inst || inst.aiScore === 'Loading') {
                showModal('분석 대기 중', 'AI 분석이 완료되지 않았습니다. 잠시 후 다시 시도해주세요.');
                return;
            }

            const similarityData = getSimilarityData(inst.name);
            const detailedAnalysis = getDetailedAnalysis(inst.name, inst.style, inst.trend);


            const reportContent = `
                <div class="space-y-6">
                    <h4 class="text-xl font-bold text-gray-800 border-b pb-2">AI 멀티모달 콘텐츠 분석 결과</h4>
                    
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div class="p-3 bg-gray-50 rounded-lg">
                            <p class="font-semibold text-gray-700">스타일 및 기법</p>
                            <p class="text-indigo-600 font-medium mt-1">${inst.style}</p>
                        </div>
                        <div class="p-3 bg-gray-50 rounded-lg">
                            <p class="font-semibold text-gray-700">시장 트렌드 부합도</p>
                            <p class="text-indigo-600 font-medium mt-1">${inst.trend}</p>
                        </div>
                    </div>

                    <div class="p-4 border rounded-lg bg-white shadow-sm">
                        <p class="font-semibold text-lg text-indigo-700 mb-2">총평 및 선정 사유</p>
                        <p class="text-gray-700 whitespace-pre-line">${detailedAnalysis}</p>
                        
                        <ul class="list-disc list-inside text-sm text-gray-600 mt-3 space-y-1">
                            <li><strong>AI 창의성 평가:</strong> 9.0/10 (독창적인 색채와 구성)</li>
                            <li><strong>AI 기술 완성도:</strong> 9.5/10 (매우 높은 전문성)</li>
                            <li><strong>잠재적 강의 주제:</strong> ${inst.style.split(' ')[0]} 마스터 클래스, ${inst.trend.split(' ')[0]} 디자인 실무</li>
                        </ul>
                    </div>
                    
                    <h4 class="text-xl font-bold text-gray-800 border-b pb-2">과거 성공 사례 유사성 분석 (Vector DB)</h4>
                    ${similarityData.length > 0 ? similarityData.map(item => `
                        <div class="p-3 bg-purple-50 rounded-lg flex justify-between items-center text-sm">
                            <div>
                                <p class="font-semibold text-purple-800">${item.courseName} (매출 기준 상위 5%)</p>
                                <p class="text-gray-700">${item.reason}</p>
                            </div>
                            <span class="font-bold text-lg text-purple-600">${item.similarity}%</span>
                        </div>
                    `).join('') : '<p class="text-gray-600">유사한 스타일의 성공 강의 사례가 존재하지 않습니다. 새로운 시장 선점 기회로 분석됩니다.</p>'}
                </div>
            `;
            
            // 모달 사이즈 조정
            const modalContainer = document.getElementById('custom-modal').querySelector('div:first-child');
            if (modalContainer) {
                modalContainer.classList.remove('max-w-lg');
                modalContainer.classList.add('max-w-3xl');
            }
            
            // 모달 콘텐츠 설정
            document.getElementById('modal-title').innerText = `[${inst.name}] AI 분석 상세 보고서`;
            document.getElementById('modal-body').innerHTML = reportContent;
            
            // 보고서 모달에는 기본 '확인' 버튼을 다시 정의하여 닫기 기능 추가
            document.getElementById('modal-buttons').innerHTML = `
                <button onclick="closeModal()" class="bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700 transition">확인</button>
            `;

            document.getElementById('custom-modal').classList.remove('hidden');
        }

        // 시뮬레이션용 유사성 데이터 제공 함수
        function getSimilarityData(name) {
            const data = {
                "Nekojira": [{ courseName: "서브컬처 캐릭터 디자인", similarity: 91, reason: "강한 명암 대비와 채색 기법의 일치" }],
                "ArtValkyrie": [{ courseName: "미래지향적 컨셉 아트", similarity: 85, reason: "네온 컬러 팔레트 및 배경 구성 유사" }],
                "PixelSmith": [{ courseName: "도트 애니메이션 심화", similarity: 78, reason: "8비트 텍스처 처리 방식 동일" }],
                "GameArtist": [{ courseName: "AAA 게임 원화 마스터", similarity: 96, reason: "인체 해부학적 이해도 및 질감 표현 기술 거의 일치" }]
            };
            return data[name] || [];
        }

        // 시뮬레이션용 상세 분석 내용 제공 함수
        function getDetailedAnalysis(name, style, trend) {
            switch (name) {
                case "Nekojira":
                    return `
                    Nekojira 작가는 ${style} 분야에서 독보적인 위치를 차지하고 있으며, 특히 X(구 트위터)를 중심으로 충성도 높은 글로벌 팬덤(${trend})을 형성하고 있습니다. AI 이미지 분석 결과, 작가의 작품은 역동적인 구도와 세밀한 질감 표현에서 최고 수준의 기술 완성도(9.5/10)를 보였습니다. 
                    \n\n현재 아시아권을 중심으로 폭발적으로 성장하는 서브컬처 시장의 핵심 니즈에 정확히 부합하며, 유사 성공 사례(91%)를 통해 볼 때 콜로소 런칭 시 높은 매출을 기대할 수 있습니다. 즉시 컨택 및 강의 기획을 진행해야 할 최우선 후보입니다.`;
                case "ArtValkyrie":
                    return `
                    ArtValkyrie는 ${style}을 주력으로 하며, 주로 인스타그램을 통해 활발히 활동합니다. AI는 그의 작품에서 미학적 완성도(9.3/10)와 함께 현재 ${trend}에서 유행하는 미래지향적 디자인 요소들을 다수 감지했습니다. 
                    \n\n특히, 네온 톤과 복잡한 구조물의 설계 능력이 뛰어나, 'Hard Surface Modeling' 등 특정 기술에 특화된 강의를 구성한다면 기존 콜로소 강의와 중복 없이 성공적인 판매를 기대할 수 있습니다.`;
                case "DigitalMonk":
                    return `
                    DigitalMonk는 Behance를 중심으로 ${style} 분야에서 활동하며, 전통 예술과 디지털 기법을 결합한 독특한 스타일을 보유하고 있습니다. AI는 해당 스타일이 ${trend}의 전통 예술을 선호하는 잠재 고객 층과 강력하게 연결될 수 있음을 확인했습니다. 
                    \n\nAI 분석상 기술 점수도 우수하지만, 희소성이 높아 독점적인 콘텐츠 경쟁력을 가집니다. 다만 Behance 기반 활동이므로, 팔로워 참여율(7%)은 다소 낮아 마케팅 전략 수립 시 이를 보완해야 합니다.`;
                case "CharcoalMaster":
                    return `
                    CharcoalMaster는 ${style}과 같이 클래식한 아트 분야에 집중하며, 비교적 안정적인 수요층을 보유하고 있습니다. AI는 이 작가의 작품에서 드로잉의 기초와 깊이 있는 표현력을 포착하여 높은 기술 평가를 내렸습니다. 
                    \n\n트렌드 반영도 측면에서는 낮지만, 꾸준한 수요가 있는 '클래식 아트' 분야의 깊이 있는 콘텐츠를 제공함으로써 콜로소의 교육 포트폴리오를 균형 있게 확장하는 데 기여할 수 있습니다.`;
                default:
                    return `
                    ${name} 작가에 대한 AI의 멀티모달 분석이 완료되었습니다.
                    \n\n전반적인 작품성은 ${style} 트렌드에 부합하며, 특히 ${trend} 시장에서 긍정적인 반응을 보일 것으로 예상됩니다. AI는 작가의 콘텐츠에서 독특한 미적 감각과 높은 기술력을 확인했으며, 이는 콜로소의 새로운 강의 주제로 매우 적합하다는 판단입니다. 상세한 스코어와 유사성 분석 결과는 위 표를 참고해 주십시오.`;
            }
        }


        // 탭 1 렌더링
        function renderCreatorDashboard() {
            const container = document.getElementById('main-content');
            const selectedInstructor = instructors.find(inst => inst.selected);
            
            let filteredInstructors;
            let titleText;

            if (activeSubTab === 'ai-result') {
                filteredInstructors = instructors.filter(inst => inst.stage === 'Qualified' || inst.aiScore === 'Loading');
                titleText = 'AI 기반 연사 스크리닝 결과';
            } else { // saved-list
                filteredInstructors = instructors.filter(inst => inst.saved);
                titleText = 'Saved Creator List (찜 목록)';
            }
            
            // 로딩 중인 항목은 항상 페이지 1에 표시
            const qualifiedInstructors = instructors.filter(inst => inst.stage === 'Qualified' || inst.aiScore === 'Loading');


            const startIndex = (currentPage - 1) * ITEMS_PER_PAGE;
            const endIndex = startIndex + ITEMS_PER_PAGE;
            const paginatedInstructors = filteredInstructors.slice(startIndex, endIndex);

            const listHTML = paginatedInstructors.map(inst => {
                const scoreColor = inst.aiScore >= 9.0 ? 'score-9' : inst.aiScore >= 8.0 ? 'score-8' : inst.aiScore === 'Loading' ? 'bg-gray-300' : 'score-7';
                const scoreDisplay = inst.aiScore === 'Loading' ? `<div class="w-5 h-5 border-2 border-indigo-400 border-t-transparent rounded-full animate-spin"></div>` : inst.aiScore.toFixed(1);
                const isSelected = selectedInstructor && selectedInstructor.id === inst.id;

                return `
                    <div class="nova-card p-4 bg-white rounded-xl shadow-md flex items-start space-x-4 mb-4 border-l-4 ${isSelected ? 'border-purple-600 ring-2 ring-purple-300' : 'border-indigo-500'} transition duration-300 hover:shadow-lg relative">
                        <!-- Bookmark Button -->
                        <button onclick="toggleBookmark(${inst.id})" class="absolute top-3 right-3 z-10 p-1 rounded-full bg-white/70 backdrop-blur-sm shadow-md">
                            ${inst.saved ? bookmarkFilled : bookmarkEmpty}
                        </button>

                        <div class="flex-grow">
                            <div class="flex justify-between items-start">
                                <div class="w-full">
                                    <div class="flex items-center space-x-2">
                                        ${logoSVG[inst.platform]}
                                        <a href="${inst.url}" target="_blank" class="text-xl font-bold text-gray-800 hover:text-indigo-600">${inst.name}</a>
                                        <span class="text-sm font-normal text-gray-500">(${inst.platform})</span>
                                    </div>
                                    <div class="mt-1 flex items-center space-x-2 text-sm text-gray-500">
                                        <span>팔로워: ${inst.followers}</span>
                                        <span class="text-indigo-500">•</span>
                                        <span>참여율: ${inst.engagement}</span>
                                    </div>
                                </div>
                                <div class="text-right flex-shrink-0 mr-10"> <!-- 북마크 공간 확보 -->
                                    <div class="font-extrabold text-2xl px-3 py-1 rounded-full flex items-center justify-center h-10 w-16 ${scoreColor}">
                                        ${scoreDisplay}
                                    </div>
                                    <p class="text-xs font-semibold text-gray-600 mt-1">AI 스코어</p>
                                </div>
                            </div>
                            <div class="mt-3" onclick="showFullReport(${inst.id})">
                                <p class="text-sm font-semibold text-indigo-700">AI 분석 (멀티모달 LLM)</p>
                                <p class="text-sm text-gray-700 mt-1 report-clickable">
                                    <strong>스타일:</strong> ${inst.style} <span class="text-gray-400">|</span> 
                                    <strong>트렌드:</strong> ${inst.trend}
                                </p>
                                <p class="text-xs text-gray-600 italic mt-1">${inst.comment.replace(/<[^>]*>?/gm, '')}</p>
                            </div>
                            <div class="mt-3 flex justify-between items-center">
                                <button onclick="deleteInstructor(${inst.id}, '${inst.name}')" class="text-sm text-red-500 hover:text-red-700">삭제</button>
                                <label class="inline-flex items-center cursor-pointer">
                                    <input type="checkbox" ${isSelected ? 'checked' : ''} onchange="toggleSelection(${inst.id})" class="form-checkbox h-5 w-5 text-purple-600 rounded-lg border-gray-300 focus:ring-purple-500">
                                    <span class="ml-2 text-sm font-medium text-gray-700">컨택 대상</span>
                                </label>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            const paginationHTML = renderPagination(filteredInstructors.length);

            const templateHTML = `
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 p-6">
                    <div class="lg:col-span-2 space-y-4">
                        <div class="flex border-b mb-4">
                            <button onclick="setSubTab('ai-result')" class="px-4 py-2 text-lg transition duration-150 ${activeSubTab === 'ai-result' ? 'sub-tab-active' : 'text-gray-500 hover:text-gray-800'}">
                                ${titleText} (${qualifiedInstructors.length}명)
                            </button>
                             <button onclick="setSubTab('saved-list')" class="px-4 py-2 text-lg transition duration-150 ${activeSubTab === 'saved-list' ? 'sub-tab-active' : 'text-gray-500 hover:text-gray-800'}">
                                Saved Creator List (${instructors.filter(i => i.saved).length}명)
                            </button>
                        </div>
                        
                        <!-- 수동 추가 기능 (AI Result 탭에서만 표시) -->
                        ${activeSubTab === 'ai-result' ? `
                        <div class="p-4 bg-indigo-50 rounded-xl flex items-center space-x-4 shadow-md">
                            <h3 class="font-bold text-indigo-800 flex-shrink-0">수동 연사 추가</h3>
                            <select id="manual-platform" class="rounded-md border-gray-300 p-2 text-sm border">
                                <option value="Instagram">Instagram ID</option>
                                <option value="Twitter/X">X ID</option>
                                <option value="Behance">Behance URL</option>
                            </select>
                            <input type="text" id="manual-id" placeholder="ID/URL 입력" class="flex-grow rounded-md border-gray-300 p-2 text-sm border">
                            <button onclick="addManualInstructor()" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition flex-shrink-0">AI 분석 요청</button>
                        </div>
                        ` : ''}

                        <!-- 연사 리스트 -->
                        <div id="instructor-list" class="space-y-4 max-h-[70vh] overflow-y-auto pr-2">
                            ${paginatedInstructors.length > 0 ? listHTML : '<p class="p-4 text-gray-500 text-center border rounded-lg">현재 목록에 해당되는 크리에이터가 없습니다.</p>'}
                            ${paginationHTML}
                        </div>
                    </div>

                    <!-- 컨택 템플릿 영역 -->
                    <div class="lg:col-span-1">
                        <h2 class="text-2xl font-bold text-gray-800 border-b pb-2">LLM 기반 컨택 템플릿</h2>
                        <div class="p-4 bg-white rounded-xl shadow-lg mt-4 space-y-4">
                            <div class="p-3 border rounded-lg bg-gray-50">
                                <p class="font-bold text-md text-indigo-700">선택 연사: ${selectedInstructor ? selectedInstructor.name : '없음'}</p>
                                <p class="text-xs text-gray-500">${selectedInstructor ? selectedInstructor.style : '좌측 목록에서 컨택 대상을 선택해주세요.'}</p>
                            </div>
                            
                            <button onclick="generateTemplateContent()" id="generate-template-btn" class="w-full bg-purple-600 text-white font-bold py-2 rounded-lg shadow-md hover:bg-purple-700 transition ${selectedInstructor ? '' : 'opacity-50 pointer-events-none'}" ${selectedInstructor ? '' : 'disabled'}>
                                🚀 맞춤형 템플릿 초안 생성 (Gemini LLM)
                            </button>
                            
                            <div id="template-output" class="space-y-4">
                                <!-- Template Editor/Preview -->
                                <div id="template-content">
                                    ${selectedInstructor ? '<p class="text-center text-gray-500">템플릿 생성 버튼을 눌러주세요.</p>' : '<p class="text-center text-gray-500">선택된 연사가 없습니다.</p>'}
                                </div>
                            </div>
                            
                            <!-- 단일 '전송' 버튼 -->
                            <button id="send-template-btn" onclick="confirmSendTemplate(${selectedInstructor ? selectedInstructor.id : 'null'})" class="w-full bg-green-600 text-white font-bold py-3 rounded-lg shadow-lg hover:bg-green-700 transition ${selectedInstructor && document.getElementById('template-content').innerHTML.includes('label') ? '' : 'opacity-50 pointer-events-none'}" ${selectedInstructor && document.getElementById('template-content').innerHTML.includes('label') ? '' : 'disabled'}>
                                전송
                            </button>
                        </div>
                    </div>
                </div>
            `;
            container.innerHTML = templateHTML;
        }

        // CRM 카드 렌더링
        function renderKanbanCard(inst) {
            const mediumIcon = inst.platform === 'Instagram' ? logoSVG['Instagram'] : inst.platform === 'Twitter/X' ? logoSVG['Twitter/X'] : logoSVG['Behance'];
            const lastContactMediumIcon = inst.lastResponse ? (inst.lastResponse.medium.includes('Instagram') ? logoSVG['Instagram'] : inst.lastResponse.medium.includes('X') ? logoSVG['Twitter/X'] : gmailIcon) : '';

            let additionalContent = '';
            let cardClass = "bg-white p-4 rounded-xl shadow-md mb-4 kanban-card cursor-pointer";

            if (inst.stage === 'In Communication' && inst.lastResponse) {
                const isUrgent = inst.lastResponse.followUpDays > 10;
                const followUpColor = isUrgent ? 'text-red-500 font-bold' : 'text-yellow-600';
                additionalContent = `
                    <div class="mt-2 pt-2 border-t border-gray-100 space-y-2">
                        <div class="flex items-center text-xs text-gray-600">
                            ${lastContactMediumIcon}
                            <span class="ml-1 font-semibold">${inst.lastResponse.medium} 응답 (D+${inst.lastResponse.followUpDays}일 경과)</span>
                        </div>
                        <p class="text-sm font-medium text-gray-800">${inst.lastResponse.summary}</p>
                        <p class="text-xs ${followUpColor}">🚨 후속 액션 필요: ${inst.lastResponse.todo.split(' ')[0]}...</p>
                    </div>
                `;
                cardClass += isUrgent ? " border-l-4 border-red-500" : " border-l-4 border-yellow-500";
            } else if (inst.stage === 'Contract') {
                additionalContent = `
                    <div class="mt-2 pt-2 border-t border-gray-100">
                        <p class="text-sm font-bold text-green-600">계약서 초안 준비 완료</p>
                        <p class="text-xs text-gray-500">최종 검토 및 발송 대기 중</p>
                    </div>
                `;
                cardClass += " border-l-4 border-green-500";
            }
            
            return `
                <div class="${cardClass}" onclick="instDetails(${inst.id}, '${inst.stage}')">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-2">
                            ${mediumIcon}
                            <p class="text-lg font-bold text-gray-800">${inst.name}</p>
                        </div>
                        <span class="text-xs font-bold ${inst.aiScore >= 9.0 ? 'score-9' : inst.aiScore >= 8.0 ? 'score-8' : 'score-7'} px-2 py-0.5 rounded">${inst.aiScore.toFixed(1)}</span>
                    </div>
                    <p class="text-sm text-gray-500 mt-1">${inst.style}</p>
                    ${additionalContent}
                </div>
            `;
        }

        // 탭 2 렌더링
        function renderContactManagement() {
             const container = document.getElementById('main-content');
            
            // 1. Qualified 항목 필터링 및 페이징
            const allQualifiedInstructors = instructors.filter(inst => inst.stage === 'Qualified' && inst.aiScore !== 'Loading');
            const startIndex = (currentPage - 1) * ITEMS_PER_PAGE;
            const endIndex = startIndex + ITEMS_PER_PAGE;
            const paginatedQualified = allQualifiedInstructors.slice(startIndex, endIndex);

            const kanbanHTML = Object.keys(funnelStages).map(stageKey => {
                const stageName = funnelStages[stageKey];
                
                let stageInstructors;
                let columnContent;
                let itemCount;

                if (stageKey === 'Qualified') {
                    stageInstructors = paginatedQualified;
                    itemCount = allQualifiedInstructors.length;
                    
                    // Qualified는 SNS 페이지 이동 기능이 주가 되도록 설정
                    const qualifiedCards = stageInstructors.map(inst => `
                        <div class="kanban-card bg-white p-4 rounded-xl shadow-md mb-4 cursor-pointer border-l-4 border-indigo-500" onclick="openInstructorPage(${inst.id})">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-2">
                                    ${logoSVG[inst.platform]}
                                    <p class="text-lg font-bold text-gray-800">${inst.name}</p>
                                </div>
                                <span class="text-xs font-bold ${inst.aiScore >= 9.0 ? 'score-9' : 'score-8'} px-2 py-0.5 rounded">${inst.aiScore.toFixed(1)}</span>
                            </div>
                            <p class="text-sm text-gray-500 mt-1">${inst.style}</p>
                            <p class="text-xs text-indigo-600 mt-2">클릭 시 SNS 페이지로 이동</p>
                        </div>
                    `).join('');
                    
                    columnContent = qualifiedCards + renderPagination(itemCount);
                } else {
                    stageInstructors = instructors.filter(inst => inst.stage === stageKey && inst.aiScore !== 'Loading');
                    itemCount = stageInstructors.length;
                    columnContent = stageInstructors.map(inst => renderKanbanCard(inst)).join('');
                }

                
                let contractSection = '';
                if (stageKey === 'Contract') {
                    contractSection = `
                        <div class="mt-4 p-4 bg-indigo-50 rounded-lg">
                            <h4 class="font-bold text-indigo-800">계약서 관리 (Step 6)</h4>
                            <p class="text-sm text-gray-600 mb-2">카드 클릭 시 계약서 초안 편집 및 발송</p>
                            <button onclick="instDetails(${stageInstructors[0].id}, 'Contract')" class="w-full bg-indigo-500 text-white text-sm py-1.5 rounded-md hover:bg-indigo-600 transition" ${stageInstructors.length > 0 ? '' : 'disabled'}>
                                계약 관리 바로가기
                            </button>
                        </div>
                    `;
                }


                return `
                    <div class="w-full lg:w-1/4 kanban-column p-4">
                        <h3 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">${stageName} <span class="text-gray-500 text-sm">(${itemCount})</span></h3>
                        <div class="space-y-4">
                            ${columnContent}
                        </div>
                        ${contractSection}
                    </div>
                `;
            }).join('');

            const contentHTML = `
                <div class="p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Creator Contact Management (CRM Funnel)</h2>
                    <div class="flex flex-wrap lg:flex-nowrap gap-6">
                        ${kanbanHTML}
                    </div>
                </div>
            `;
            container.innerHTML = contentHTML;
        }
        
        // 적격 후보 리스트 클릭 시 해당 연사 SNS 페이지 새 탭으로 열기
        function openInstructorPage(id) {
            const inst = instructors.find(i => i.id === id);
            if (inst && inst.url) {
                window.open(inst.url, '_blank');
            }
        }

        // CRM 상세 모달 표시
        function instDetails(id, stage) {
            const inst = instructors.find(i => i.id === id);
            let title = `${inst.name} (${funnelStages[stage]})`;
            let content = '';

            if (stage === 'Qualified') {
                 // Qualified는 SNS 연결 기능이 주가 되므로, 여기서 openInstructorPage를 다시 호출하여 UX 통일성을 제공
                 openInstructorPage(id);
                 showModal('페이지 이동 안내', `<p class="text-md font-semibold">${inst.name}님의 ${inst.platform} 페이지를 새 탭으로 열었습니다.</p><p class="text-sm text-gray-500 mt-2">AI 분석 상세 정보를 직접 확인해보세요.`, false);
                 return; 
            } else if (stage === 'Initial Contact Sent' && inst.lastContact) {
                // 초기 컨택 완료 상세
                content = `
                    <div class="space-y-4">
                        <p class="text-lg font-bold text-gray-800 border-b pb-2">컨택 발송 이력</p>
                        <div class="p-4 bg-indigo-50 rounded-lg space-y-2">
                            <p class="text-sm font-semibold text-indigo-800 flex items-center">${inst.lastContact.medium.includes('Gmail') ? logoSVG['Gmail'] : inst.platform === 'Instagram' ? logoSVG['Instagram'] : logoSVG['Twitter/X']} <span class="ml-2">${inst.lastContact.medium}</span> 발송</p>
                            <p class="text-xs text-gray-600">발송 일자: ${inst.lastContact.date} | 발송 담당: ${inst.lastContact.planner}</p>
                            <p class="text-md font-medium text-gray-700 mt-2">${inst.lastContact.content.split('\n')[0].substring(0, 50)}...</p>
                            <button class="text-indigo-600 text-sm font-semibold hover:text-indigo-800 mt-1" onclick="showModal('발송 원본', '<textarea readonly class=\\'w-full h-80 p-2 border rounded-lg text-sm\\'>${inst.lastContact.content.replace(/'/g, '&#39;').replace(/"/g, '&quot;')}</textarea>', false)">원본 내용 확인</button>
                        </div>
                        <p class="text-red-500 font-bold">⚠️ 회신 대기 중 (D+${(new Date() - new Date(inst.lastContact.date)) / (1000 * 3600 * 24) | 0}일 경과)</p>
                    </div>
                `;
            } else if (stage === 'In Communication' && inst.lastResponse) {
                // 협의 진행 중 상세 (회신 및 회신 옵션)
                const url = inst.platform === 'Instagram' ? `https://instagram.com/${inst.name}` : inst.platform === 'Twitter/X' ? `https://x.com/${inst.name}` : inst.url; 

                content = `
                    <div class="space-y-4">
                        <p class="text-lg font-bold text-gray-800 border-b pb-2">최신 응답 및 AI To-Do</p>
                        <div class="p-4 bg-yellow-50 rounded-lg border-l-4 border-yellow-500 space-y-2">
                            <p class="text-md font-bold text-yellow-800 flex items-center">${inst.lastResponse.medium} 응답 (D+${inst.lastResponse.followUpDays}일 경과)</p>
                            <p class="text-sm font-medium text-gray-700">${inst.lastResponse.summary}</p>
                            <p class="text-xs text-red-500 font-bold">AI To-Do: ${inst.lastResponse.todo}</p>
                            <a href="${url}" target="_blank" class="text-indigo-600 text-sm font-semibold hover:text-indigo-800 mt-1 flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13l2-2 2 2"></path><path d="M12 2v10"></path><path d="M22 10V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v4"></path></svg>
                                응답 매체로 이동 (새 탭)
                            </a>
                        </div>
                        
                        <div class="p-4 bg-white rounded-lg shadow">
                            <h3 class="font-bold text-indigo-700 mb-2">💡 LLM 기반 회신 옵션</h3>
                            <div id="reply-content">
                                <!-- 템플릿 영역 -->
                            </div>
                            <button onclick="generateTemplateContent(true, ${inst.id});" class="w-full bg-indigo-500 text-white py-2 rounded-lg hover:bg-indigo-600 transition mt-2">
                                AI 회신 내용 생성 & 편집
                            </button>
                        </div>
                    </div>
                `;
            } else if (stage === 'Contract') {
                // 계약 단계 상세
                title = `${inst.name} - 계약서 초안 관리`;
                content = `
                    <div class="space-y-4">
                        <div class="flex space-x-4 mb-4">
                            <button onclick="generateContractDraft('${inst.name}')" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition">AI 계약서 초안 자동 생성</button>
                            <button onclick="loadExistingContract('${inst.name}')" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300 transition">기존 템플릿 불러오기</button>
                        </div>
                        <textarea id="contract-editor" class="w-full h-80 p-4 border rounded-lg focus:ring-indigo-500 focus:border-indigo-500 text-sm" placeholder="계약서 초안을 여기에 작성하거나 AI 생성 버튼을 눌러주세요.">${
                            inst.contractDraft || '계약서 초안이 생성되지 않았습니다.'
                        }</textarea>
                        
                        <div class="flex justify-between items-center pt-2 border-t">
                            <button onclick="downloadPdf('${inst.name}_강의_계약서.pdf')" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition">PDF 다운로드</button>
                            <button onclick="sendContractEmail('${inst.name}')" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition flex items-center">
                                ${logoSVG['Gmail']}
                                <span class="ml-1">최종 계약서 발송 (Gmail API)</span>
                            </button>
                        </div>
                    </div>
                `;
            }

            // 모달을 열기 전에 모달 내용을 설정
            document.getElementById('modal-title').innerText = title;
            document.getElementById('modal-body').innerHTML = content;
            document.getElementById('custom-modal').classList.remove('hidden');
        }
        
        // 계약서 초안 자동 생성 시뮬레이션
        function generateContractDraft(name) {
            const inst = instructors.find(i => i.name === name);
            const editor = document.getElementById('contract-editor');
            if (editor) {
                editor.value = `[AI 기반 ${name} 계약서 초안 생성]\n\n1. 강의명: [AI 추천: ${inst.style} 마스터 클래스]\n2. 연사: ${name}\n3. 강의료: [AI 최적 제안: 45,000,000원]\n4. 제작 기간: 6개월\n5. 권리: Coloso 독점 사용\n\n[LLM 상세 조항 추가: AI 분석 결과 (${inst.aiScore}점)에 따라 초기 계약금 5% 추가 인센티브 조항 삽입]\n\n**본 초안은 LLM을 통해 자동 생성되었으며, 최종 검토 및 수정이 필요합니다.**`;
                showModal('초안 생성 완료', 'AI가 분석 데이터를 기반으로 계약서 초안을 성공적으로 생성했습니다.', true);
            }
        }

        // 기존 템플릿 불러오기 시뮬레이션
        function loadExistingContract(name) {
            const editor = document.getElementById('contract-editor');
            if (editor) {
                editor.value = `[기존 Coloso 표준 계약서 템플릿 (2024년 버전)]\n\n1. 강의명: [미정]\n2. 연사: ${name}\n3. 강의료: [표준 기준 적용]\n4. 제작 기간: 8개월\n\n**템플릿을 기반으로 연사와의 협의 내용을 수동으로 반영해주세요.**`;
                showModal('템플릿 불러오기 완료', '표준 계약서 템플릿을 불러왔습니다. 내용을 수정하여 사용해주세요.');
            }
        }


        // 전체 앱 렌더링
        function renderApp() {
            // 사이드바 업데이트
            document.getElementById('tab-dashboard').classList.toggle('tab-active', activeTab === 'dashboard');
            document.getElementById('tab-crm').classList.toggle('tab-active', activeTab === 'crm');

            // 메인 콘텐츠 렌더링
            if (activeTab === 'dashboard') {
                // 'dashboard' 탭으로 전환 시, currentPage를 1로 재설정
                currentPage = 1; 
                renderCreatorDashboard();
            } else if (activeTab === 'crm') {
                // 'crm' 탭으로 전환 시, currentPage를 1로 재설정 (Qualified Funnel의 페이징을 위해)
                currentPage = 1;
                renderContactManagement();
            }
        }

        // 초기 로드
        window.onload = () => {
            renderApp();
        };
    </script>
</head>
<body class="flex h-screen overflow-hidden">

    <!-- Custom Modal (alert 대체) -->
    <div id="custom-modal" class="hidden fixed inset-0 flex items-center justify-center z-50 transition-opacity duration-300 modal-backdrop">
        <div class="bg-white rounded-xl shadow-2xl max-w-lg w-full m-4" onclick="event.stopPropagation();">
            <div class="p-6">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center">
                        <div id="modal-icon" class="flex-shrink-0 mr-3"></div>
                        <h3 id="modal-title" class="text-2xl font-bold text-gray-800">알림</h3>
                    </div>
                    <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
                <div id="modal-body" class="text-gray-700 space-y-3 max-h-96 overflow-y-auto pr-2">
                    <!-- Dynamic content here -->
                </div>
                <div id="modal-buttons" class="mt-6 text-right space-x-2">
                    <!-- Buttons here -->
                    <button onclick="closeModal()" class="bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700 transition">확인</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 1. 사이드 내비게이션 -->
    <nav class="w-64 bg-gray-800 text-white flex flex-col flex-shrink-0">
        <div class="p-6 text-3xl font-extrabold text-indigo-400 border-b border-gray-700">
            Coloso NOVA
        </div>
        <div class="flex flex-col p-4 space-y-2">
            <button id="tab-dashboard" onclick="setTab('dashboard')" class="tab-active flex items-center p-3 rounded-lg hover:bg-gray-700 transition duration-150">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"/><path d="M18.7 8l-4.2 4.5-5-5L6 15"/></svg>
                <span>Creator Dashboard</span>
            </button>
            <button id="tab-crm" onclick="setTab('crm')" class="flex items-center p-3 rounded-lg hover:bg-gray-700 transition duration-150">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="12" y1="3" x2="12" y2="21"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                <span>Creator Contact Management</span>
            </button>
        </div>
        <div class="mt-auto p-4 text-xs text-gray-500 border-t border-gray-700">
            <p>Powered by Gemini LLM & Coloso Data</p>
        </div>
    </nav>

    <!-- 2. 메인 콘텐츠 영역 -->
    <main id="main-content" class="flex-grow overflow-y-auto">
        <!-- Content will be rendered by JavaScript -->
    </main>
</body>
</html>
